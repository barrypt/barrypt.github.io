---
title: "Kubernetesæ•™ç¨‹(åä¸€)---ä½¿ç”¨ KubeClipper é€šè¿‡ä¸€æ¡å‘½ä»¤å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤"
description: "ä½¿ç”¨ KubeClipper é€šè¿‡ä¸€æ¡å‘½ä»¤å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤"
date: 2022-08-20
draft: false
categories: ["Kubernetes"]
tags: ["Kubernetes"]
---

æœ¬æ–‡ä¸»è¦è®°å½•äº†å¦‚ä½•ä½¿ç”¨å¼€æºé¡¹ç›® KubeClipper é€šè¿‡ä¸€æ¡å‘½ä»¤å¿«é€Ÿåˆ›å»º k8s é›†ç¾¤ã€‚

<!--more-->

>  2022-12-12ï¼Œ[KubeClipper](https://github.com/kubeclipper) å‘å¸ƒ[ release-1.3.1](https://github.com/kubeclipper/kubeclipper/releases/tag/v1.3.1) ç‰ˆæœ¬ï¼Œæœ¬æ–‡ä¹ŸåŒæ­¥è¿›è¡Œæ›´æ–°
>
>  **1.3.1 ç‰ˆæœ¬æœ€å¤§æå‡åœ¨äºéƒ¨ç½²ä½“éªŒä»¥åŠå®‰è£…é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ï¼ŒåŒæ—¶ä¸€äº›é”™è¯¯æç¤ºä¹Ÿæ›´åŠ äººæ€§åŒ–ï¼Œä½¿ç”¨ä½“éªŒæ–¹ä¾¿æœ‰è¾ƒå¤§æå‡**ã€‚
>
>  **éƒ¨ç½²å‚æ•°å¤§å¹…å‡å°‘**ï¼š1.3.1 ç‰ˆæœ¬ aio éƒ¨ç½²ç”šè‡³ä¸éœ€è¦ä»»ä½•å‚æ•°ï¼Œkcctl deploy å³å¯å®Œæˆéƒ¨ç½²ï¼Œå¤šèŠ‚ç‚¹éƒ¨ç½²ä¹Ÿåªéœ€è¦æä¾›ä¸¤ä¸‰ä¸ªå‚æ•°å³å¯ï¼Œè¾ƒä¹‹å‰ä½“éªŒä¸Šæœ‰è¾ƒå¤§æå‡ã€‚
>
>  **é›†ç¾¤å®‰è£…é€Ÿåº¦å¤§å¹…æå‡**ï¼šä¹‹å‰å•èŠ‚ç‚¹é›†ç¾¤éœ€è¦ 3 åˆ†é’Ÿï¼Œ5èŠ‚ç‚¹é«˜å¯ç”¨é›†ç¾¤éœ€è¦ 9åˆ†é’Ÿï¼Œ1.3.1 ç‰ˆæœ¬å•èŠ‚ç‚¹åªéœ€è¦ä¸¤åˆ†é’Ÿï¼Œ5 èŠ‚ç‚¹ä¹Ÿåªéœ€è¦4åˆ†é’Ÿã€‚æ•´ä¸ªéƒ¨ç½²æ—¶é—´å¹¶ä¸ä¼šéšç€èŠ‚ç‚¹å¢åŠ è€Œçº¿æ€§å¢åŠ ã€‚

ä¹‹å‰å†™äº†ä¸€ç¯‡ä½¿ç”¨ kubeadm åˆ›å»ºé›†ç¾¤çš„æ–‡ç« ï¼š [Kubernetesæ•™ç¨‹(ä¸€)---ä½¿ç”¨ kubeadm åˆ›å»º k8s é›†ç¾¤(containerd)](https://www.lixueduan.com/posts/kubernetes/01-install/)ï¼Œæ•´ä¸ªæµç¨‹ä¸‹æ¥å…¶å®è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½“éªŒå¹¶ä¸æ˜¯å¤ªå¥½ï¼Œä»Šå¤©ç»™å¤§å®¶æ¨èä¸€ä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼š[KubeClipper ](https://github.com/kubeclipper/kubeclipper)ã€‚



## 1. ä»€ä¹ˆæ˜¯ KubeClipper

KubeClipper æ—¨åœ¨æä¾›æ˜“ä½¿ç”¨ã€æ˜“è¿ç»´ã€æè½»é‡ã€ç”Ÿäº§çº§çš„ Kubernetes å¤šé›†ç¾¤å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†æœåŠ¡ï¼Œè®©è¿ç»´å·¥ç¨‹å¸ˆä»ç¹å¤çš„é…ç½®å’Œæ™¦æ¶©çš„å‘½ä»¤è¡Œä¸­è§£æ”¾å‡ºæ¥ï¼Œå®ç°ä¸€ç«™å¼ç®¡ç†è·¨åŒºåŸŸã€è·¨åŸºç¡€è®¾æ–½çš„å¤š K8S é›†ç¾¤ã€‚

KubeClipper çš„ 3ä¸ªä¼˜åŠ¿ï¼š

* 1ï¼‰æ˜“ä½¿ç”¨ï¼šå›¾å½¢åŒ–é¡µé¢
  * æä¾› Web æ§åˆ¶å°ï¼Œé€šè¿‡ç‚¹ç‚¹é¼ æ ‡å³å¯åˆ›å»ºä¸€ä¸ª k8s é›†ç¾¤
* 2ï¼‰æè½»é‡ï¼šæ¶æ„ç®€å•ï¼Œå°‘ä¾èµ–
  * ä¸ä¾èµ– ansibleï¼Œä½¿ç”¨æ–¹ä¾¿
* 3ï¼‰ç”Ÿäº§çº§ï¼šæ˜“ç”¨æ€§å’Œä¸“ä¸šæ€§å…¼é¡¾
  * æä¾›åœ¨çº¿ã€ç¦»çº¿ã€ä»£ç†æ–¹å¼éƒ¨ç½²ä»¥åŠå¤šç‰ˆæœ¬ K8Sã€CRIã€CNI é€‰æ‹©
  * æä¾›äº†ç¦»çº¿éƒ¨ç½²æ–¹å¼å¯¹**å›½å†…ç”¨æˆ·æä¸ºå‹å¥½**ï¼Œæ¯•ç«Ÿç½‘ç»œæ‰æ˜¯å›½å†…ç”¨æˆ·è£… k8s çš„ä¸€å¤§éš¾é¢˜ã€‚

å…³äºè¯¥é¡¹ç›®çš„æ›´å¤šä¿¡æ¯è§ï¼š[Github Repo](https://github.com/kubeclipper/kubeclipper) ä»¥åŠå®˜æ–¹çš„è¿™ç¯‡ä»‹ç»æ–‡ç« ï¼š[KubeClipperâ€”â€”è½»é‡ä¾¿æ·çš„ Kubernetes å¤šé›†ç¾¤å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…·](https://mp.weixin.qq.com/s/RVUB5Pw6-A5zZAQktl8AcQ)

ä¸€å¥è¯æ¦‚æ‹¬ï¼š**KubeClipper æ˜¯ä¸€ä¸ªè½»é‡ä¾¿æ·çš„ Kubernetes å¤šé›†ç¾¤å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†å·¥å…·**ã€‚



## 2. å¿«é€Ÿå¼€å§‹

### å‡†å¤‡å·¥ä½œ

KubeClipper æœ¬èº«å¹¶ä¸ä¼šå ç”¨å¤ªå¤šèµ„æºï¼Œä½†æ˜¯ä¸ºäº†åç»­æ›´å¥½çš„è¿è¡Œ Kubernetes å»ºè®®ç¡¬ä»¶é…ç½®ä¸ä½äºæœ€ä½è¦æ±‚ã€‚

æ‚¨ä»…éœ€å‚è€ƒä»¥ä¸‹å¯¹æœºå™¨ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„è¦æ±‚å‡†å¤‡ä¸€å°ä¸»æœºã€‚

#### ç¡¬ä»¶æ¨èé…ç½®

- ç¡®ä¿æ‚¨çš„æœºå™¨æ»¡è¶³æœ€ä½ç¡¬ä»¶è¦æ±‚ï¼šCPU >= 2 æ ¸ï¼Œå†…å­˜ >= 2GBã€‚
- æ“ä½œç³»ç»Ÿï¼šCentOS 7.x / Ubuntu 18.04 / Ubuntu 20.04ã€‚

#### èŠ‚ç‚¹è¦æ±‚

- èŠ‚ç‚¹å¿…é¡»èƒ½å¤Ÿé€šè¿‡ `SSH` è¿æ¥ã€‚
- èŠ‚ç‚¹ä¸Šå¯ä»¥ä½¿ç”¨ `sudo` / `curl` / `wget` / `tar` / `gzip`å‘½ä»¤ã€‚

> å»ºè®®æ‚¨çš„æ“ä½œç³»ç»Ÿå¤„äºå¹²å‡€çŠ¶æ€ï¼ˆä¸å®‰è£…ä»»ä½•å…¶ä»–è½¯ä»¶ï¼‰ï¼Œå¦åˆ™å¯èƒ½ä¼šå‘ç”Ÿå†²çªã€‚



å®é™…ä¸Šè¿™äº›è¦æ±‚åŸºæœ¬ä¸Šä¸ç”¨ç‰¹åˆ«å¤„ç†ï¼Œéšä¾¿æ‰¾ä¸€å°æœºå™¨éƒ½æ»¡è¶³æ¡ä»¶ï¼Œæœ¬æ–‡å°±ä½¿ç”¨ä¸€å° 2C4G çš„ CentOS 7.9 æœºå™¨æ¥éƒ¨ç½²ã€‚



### å®‰è£… KubeClipper

#### ä¸‹è½½ kcctl

KubeClipper æä¾›äº†å‘½ä»¤è¡Œå·¥å…·ğŸ”§ kcctlï¼Œæˆ‘ä»¬å…ˆå®‰è£… kcctlï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
curl -sfL https://oss.kubeclipper.io/kcctl.sh | KC_REGION=cn VERSION=v1.3.1 bash -
```

é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ:

```bash
kcctl version
```



#### å¼€å§‹å®‰è£…

ç„¶åä½¿ç”¨ kcctl å®‰è£… kubeclipperï¼Œä¸€æ¡å‘½ä»¤å³å¯,æ¨¡æ¿å¦‚ä¸‹ï¼š

```bash
kcctl deploy
```

kcctl å°†æ£€æŸ¥å®‰è£…ç¯å¢ƒï¼Œè‹¥æ»¡è¶³æ¡ä»¶åˆ™ä¼šåœ¨å½“å‰èŠ‚ç‚¹å®‰è£… kubeclipperï¼Œåœ¨æ‰“å°å‡ºå¦‚ä¸‹çš„ KubeClipper banner åå³è¡¨ç¤ºå®‰è£…å®Œæˆã€‚

```
 _   __      _          _____ _ _
| | / /     | |        /  __ \ (_)
| |/ / _   _| |__   ___| /  \/ |_ _ __  _ __   ___ _ __
|    \| | | | '_ \ / _ \ |   | | | '_ \| '_ \ / _ \ '__|
| |\  \ |_| | |_) |  __/ \__/\ | | |_) | |_) |  __/ |
\_| \_/\__,_|_.__/ \___|\____/_|_| .__/| .__/ \___|_|
                                 | |   | |
                                 |_|   |_|
```

> å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦å»é˜¿é‡Œäº‘ä¸‹è½½ç¦»çº¿å®‰è£…åŒ…ï¼Œå¤§æ¦‚ 1 åˆ†é’Ÿå³å¯ä¸‹è½½å®Œæˆã€‚



### ç™»å½•æ§åˆ¶å°

å®‰è£…å®Œæˆåï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® `http://$IP` å³å¯è¿›å…¥ KubeClipper æ§åˆ¶å°ã€‚

![](../../../img/kubernetes/kubeclipper/kc-console-login.png)

æ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤å¸å·å¯†ç  `admin / Thinkbig1` è¿›è¡Œç™»å½•ã€‚

> æ‚¨å¯èƒ½éœ€è¦é…ç½®ç«¯å£è½¬å‘è§„åˆ™å¹¶åœ¨å®‰å…¨ç»„ä¸­å¼€æ”¾ç«¯å£ï¼Œä»¥ä¾¿å¤–éƒ¨ç”¨æˆ·è®¿é—®æ§åˆ¶å°ã€‚

> æ–‡ä¸­æ‰€æœ‰æ“ä½œå‡é€šè¿‡å‘½ä»¤è¡Œå·¥å…·å®Œæˆï¼Œè‡³äºæ§åˆ¶å°ç›¸å…³åŠŸèƒ½åˆ™ç”±å¤§å®¶è‡ªè¡Œæ¢ç´¢äº†~



###  å®‰è£… K8S é›†ç¾¤

éƒ¨ç½²æˆåŠŸåå¯ä»¥ä½¿ç”¨ **kcctl å·¥å…·**æˆ–è€…é€šè¿‡**æ§åˆ¶å°**åˆ›å»º k8s é›†ç¾¤ï¼Œ è¿™é‡Œå’±ä»¬ä½¿ç”¨ kcctl å·¥å…·è¿›è¡Œåˆ›å»ºã€‚

> å‘½ä»¤è¡Œï¼Œç¨‹åºçŒ¿æœ€åçš„å€”å¼ºã€‚

é¦–å…ˆä½¿ç”¨é»˜è®¤è´¦å·å¯†ç è¿›è¡Œç™»å½•è·å– tokenï¼Œä¾¿äºåç»­ kcctl å’Œ kc-server è¿›è¡Œäº¤äº’ã€‚

```bash
kcctl login -H http://localhost -u admin -p Thinkbig1
```

æŸ¥çœ‹å½“å‰ agent èŠ‚ç‚¹

```bash
[root@iZbp1cz9txcv4n6uluew1jZ ~]# kcctl get node
+--------------------------------------+----------+---------+----------------+-------------+-----+--------+
|                  ID                  | HOSTNAME | REGION  |       IP       |   OS/ARCH   | CPU |  MEM   |
+--------------------------------------+----------+---------+----------------+-------------+-----+--------+
| f22d488f-af17-47cb-ab55-07f8c4cce5f0 | server1  | default | 172.20.175.140 | linux/amd64 |   2 | 3645Mi |
+--------------------------------------+----------+---------+----------------+-------------+-----+--------+

```

ç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º k8s é›†ç¾¤:

```bash
# å…¶ä¸­ IP ä¸ºä¸Šä¸€æ­¥ä¸­çš„ server1 èŠ‚ç‚¹ IP
kcctl create cluster --name demo --master 172.20.175.140 --untaint-master
```

å¤§æ¦‚ä¸¤åˆ†é’Ÿå·¦å³å³å¯å®Œæˆé›†ç¾¤åˆ›å»º,å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š

```bash
while true;
do 
logDir="/var/log/kc-agent";
op=$(ll $logDir -t|grep -v total|head -n 1|awk '{print $9}');
echo -e "\nå½“å‰æ“ä½œ IDï¼š"$op;
latestSteps=$(ll "$logDir/$op" -t|grep -v total|head -n 1|awk '{print $9}');
echo -e "å½“å‰æœ€æ–°æ­¥éª¤ï¼š"$latestSteps"\n";
tail -n 20 "$logDir/$op/$latestSteps";
sleep 3;
done
```

æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

```bash
kcctl get cluster -o yaml|grep status -A5
```

> ä¹Ÿå¯ä»¥è¿›å…¥æ§åˆ¶å°æŸ¥çœ‹**å®æ—¶æ—¥å¿—**ã€‚

è¿›å…¥ Running çŠ¶æ€å³è¡¨ç¤ºé›†ç¾¤å®‰è£…å®Œæˆ,æ‚¨å¯ä»¥ä½¿ç”¨ `kubectl get cs` å‘½ä»¤æ¥æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µã€‚

```bash
$ kubectl get cs
NAME                 STATUS    MESSAGE                         ERROR
scheduler            Healthy   ok                              
controller-manager   Healthy   ok                              
etcd-0               Healthy   {"health":"true","reason":""} 
```



è‡³æ­¤ï¼Œæˆ‘ä»¬çš„å•èŠ‚ç‚¹ç‰ˆæœ¬å°±ç®—æ˜¯ç»“æŸäº†ï¼Œç›¸æ¯”ä¹‹ä¸‹ç¡®å®æ¯”ä½¿ç”¨åŸç”Ÿ kubeadm ä½“éªŒå¥½å¤šäº†ã€‚



## 3. å¤šèŠ‚ç‚¹ç‰ˆæœ¬

ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œk8s é›†ç¾¤è‡³å°‘éœ€è¦ 3ä¸ª master èŠ‚ç‚¹ï¼ŒåŒæ—¶ kubeclipper ä½¿ç”¨ etcd ä½œä¸ºåç«¯å­˜å‚¨ï¼Œä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œä¹Ÿå»ºè®®è‡³å°‘ä½¿ç”¨ 3 èŠ‚ç‚¹åŠä»¥ä¸Šæ¥éƒ¨ç½²ã€‚

>  åŒæ—¶ç”Ÿäº§ç¯å¢ƒä¸€èˆ¬å»ºè®® kubeclipper server èŠ‚ç‚¹å•ç‹¬å­˜åœ¨ï¼Œä¸å»ºè®®å°† server èŠ‚ç‚¹åŒæ—¶ä½œä¸º agent èŠ‚ç‚¹ä½¿ç”¨ã€‚

èŠ‚ç‚¹è§„åˆ’å¦‚ä¸‹ï¼š

* 3 å° ä½œä¸º kubeclipper server éƒ¨ç½²ä½¿ç”¨
* 5 å° ä½œä¸º kubeclipper agent èŠ‚ç‚¹ï¼Œéƒ¨ç½² k8s ä½¿ç”¨ã€‚

> èµ„æºæœ‰é™ï¼Œä¾æ—§æ˜¯ 2C4G çš„ CentOS 7.9 æœºå™¨



### å®‰è£… KubeClipper

åŒæ ·çš„ï¼Œè¿˜æ˜¯éœ€è¦å…ˆå®‰è£… kcctl å·¥å…·ï¼Œå®‰è£…æ–¹å¼å’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ï¼Œä¸€æ¡å‘½ä»¤æå®šï¼š

> kcctl å·¥å…·åªéœ€è¦åœ¨ä»»æ„ä¸€å°èŠ‚ç‚¹ä¸Šå®‰è£…å³å¯ï¼Œåªè¦èƒ½ä½¿ç”¨ ssh è®¿é—®å…¶ä»–èŠ‚ç‚¹å³å¯ã€‚
>
> ä¸ºäº†å’Œæœ¬æ•™ç¨‹ä¿æŒä¸€è‡´ï¼Œå»ºè®®åœ¨å…¶ä¸­çš„ä¸€å° server èŠ‚ç‚¹ä¸Šå®‰è£…ã€‚

```bash
curl -sfL https://oss.kubeclipper.io/kcctl.sh | KC_REGION=cn VERSION=v1.3.1 bash -
```



æ¥ç€ä½¿ç”¨ kcctl éƒ¨ç½² KubeClipperï¼Œå…¶æ¨¡æ¿å¦‚ä¸‹æ‰€ç¤ºï¼š

```bash
kcctl deploy  [--user root] (--passwd SSH_PASSWD | --pk-file SSH_PRIVATE_KEY) (--server SERVER_NODES) (--agent AGENT_NODES)
```

> éœ€è¦æ‰‹åŠ¨æŒ‡å®š server èŠ‚ç‚¹ä»¥åŠ agent èŠ‚ç‚¹ã€‚

è‹¥ä½¿ç”¨ å¯†ç  æ–¹å¼åˆ™å‘½ä»¤å¦‚ä¸‹æ‰€ç¤º:

```bash
kcctl deploy --passwd $SSH_PASSWD --server SERVER_NODES --agent AGENT_NODES
```

ç§é’¥ æ–¹å¼å¦‚ä¸‹ï¼š

```bash
kcctl deploy --pk-file $SSH_PRIVATE_KEY --server SERVER_NODES --agent AGENT_NODES
```

æœ¬æ•™ç¨‹ä½¿ç”¨ å¯†ç  æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œå…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
# 3 ä¸ª server èŠ‚ç‚¹ï¼Œ5 ä¸ª agent èŠ‚ç‚¹ï¼Œå¤šä¸ª IP ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”
servers=172.20.175.140,172.20.175.142,172.20.175.146
agents=172.20.175.145,172.20.175.143,172.20.175.144,172.20.175.139,172.20.175.141

kcctl deploy --server $servers --agent $agents --passwd Thinkbig1
```



åŒæ ·çš„ï¼Œåœ¨æ‰“å°å‡ºå¦‚ä¸‹çš„ KubeClipper banner åå³è¡¨ç¤ºå®‰è£…å®Œæˆã€‚

```text
 _   __      _          _____ _ _
| | / /     | |        /  __ \ (_)
| |/ / _   _| |__   ___| /  \/ |_ _ __  _ __   ___ _ __
|    \| | | | '_ \ / _ \ |   | | | '_ \| '_ \ / _ \ '__|
| |\  \ |_| | |_) |  __/ \__/\ | | |_) | |_) |  __/ |
\_| \_/\__,_|_.__/ \___|\____/_|_| .__/| .__/ \___|_|
                                 | |   | |
                                 |_|   |_|
```



### åˆ›å»ºé«˜å¯ç”¨ K8S é›†ç¾¤

è¿™é‡Œæˆ‘ä»¬åŒæ ·ä½¿ç”¨ kcctl å·¥å…·ï¼Œé€šè¿‡å‘½ä»¤è¡Œæ–¹å¼è¿›è¡Œåˆ›å»ºã€‚è€è§„çŸ©ï¼Œä½¿ç”¨é»˜è®¤è´¦å·å¯†ç è¿›è¡Œç™»å½•ï¼š

```bash
kcctl login -H http://localhost -u admin -p Thinkbig1
```

ç„¶åæŸ¥çœ‹ä¸€ä¸‹å½“å‰çš„ agent èŠ‚ç‚¹ä¿¡æ¯ï¼š

```bash
[root@server1 ~]# kcctl get node
+--------------------------------------+----------+---------+----------------+-------------+-----+--------+
|                  ID                  | HOSTNAME | REGION  |       IP       |   OS/ARCH   | CPU |  MEM   |
+--------------------------------------+----------+---------+----------------+-------------+-----+--------+
| a0e33d98-fd43-4e69-9700-3bc201b16a3b | agent1   | default | 172.20.175.145 | linux/amd64 |   2 | 3645Mi |
| 4a62dc30-b1a5-42b3-87e2-373733e6ae71 | agent2   | default | 172.20.175.143 | linux/amd64 |   2 | 3645Mi |
| b5a45667-38fd-4448-ad59-2c93bc049f37 | agent5   | default | 172.20.175.141 | linux/amd64 |   2 | 3645Mi |
| 2f5a889a-8ee3-4f7d-9a41-ba55761c89bc | agent4   | default | 172.20.175.139 | linux/amd64 |   2 | 3645Mi |
| ea9790f7-add6-4f96-997a-6ef1061b6907 | agent3   | default | 172.20.175.144 | linux/amd64 |   2 | 3645Mi |
+--------------------------------------+----------+---------+----------------+-------------+-----+--------+
```

æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ `kcctl create cluster` å‘½ä»¤åˆ›å»ºé›†ç¾¤äº†,å‘½ä»¤æ¨¡ç‰ˆå¦‚ä¸‹ï¼š

```bash
kcctl create cluster (--name CLUSTER_NAME) (--master NODES) [--worker NODES][ --untaint-master] 
```

> æ›´å¤šä¿¡æ¯è§ `kcctl create cluster -h`

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°† agent1ã€2ã€3 ä½œä¸º master èŠ‚ç‚¹ï¼Œagent4ã€5ä½œä¸º worker èŠ‚ç‚¹ï¼Œå®Œæ•´å‘½ä»¤å¦‚ä¸‹ï¼š

```bash
masters=172.20.175.145,172.20.175.143,172.20.175.144
workers=172.20.175.139,172.20.175.141

kcctl create cluster --name demo --master $masters --worker $workers
```

å¯¹äºè¿™æ ·ä¸€ä¸ª 5 èŠ‚ç‚¹çš„é›†ç¾¤å¤§æ¦‚ 3 åˆ° 4 åˆ†é’Ÿå³å¯åˆ›å»ºå®Œæˆã€‚

å¯ä»¥ ssh åˆ°ç¬¬ä¸€ä¸ª master èŠ‚ç‚¹å¯¹åº”çš„ agent èŠ‚ç‚¹ï¼ˆå³ agent1ï¼‰ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š

```bash
while true;
do 
logDir="/var/log/kc-agent";
op=$(ll $logDir -t|grep -v total|head -n 1|awk '{print $9}');
echo -e "\nå½“å‰æ“ä½œ IDï¼š"$op;
latestSteps=$(ll "$logDir/$op" -t|grep -v total|head -n 1|awk '{print $9}');
echo -e "å½“å‰æœ€æ–°æ­¥éª¤ï¼š"$latestSteps"\n";
tail -n 20 "$logDir/$op/$latestSteps";
sleep 3;
done
```

æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

```bash
kcctl get cluster -o yaml|grep status -A5
```

> ä¹Ÿå¯ä»¥è¿›å…¥æ§åˆ¶å°æŸ¥çœ‹**å®æ—¶æ—¥å¿—**ã€‚



è¿›å…¥ Running çŠ¶æ€å³è¡¨ç¤ºé›†ç¾¤å®‰è£…å®Œæˆ,æ‚¨å¯ä»¥ä½¿ç”¨ `kubectl get cs` å‘½ä»¤æ¥æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µã€‚

**ssh åˆ°ä»»æ„ master èŠ‚ç‚¹**ä¸ŠæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š

```bash
[root@agent1 ~]# kubectl get cs
Warning: v1 ComponentStatus is deprecated in v1.19+
NAME                 STATUS    MESSAGE                         ERROR
scheduler            Healthy   ok                              
controller-manager   Healthy   ok                              
etcd-0               Healthy   {"health":"true","reason":""}   
[root@agent1 ~]# kubectl get node
NAME     STATUS   ROLES                  AGE     VERSION
agent1   Ready    control-plane,master   3m38s   v1.23.6
agent2   Ready    control-plane,master   3m13s   v1.23.6
agent3   Ready    control-plane,master   3m12s   v1.23.6
agent4   Ready    <none>                 2m18s   v1.23.6
agent5   Ready    <none>                 2m17s   v1.23.6
```

å¯ä»¥çœ‹åˆ°ï¼Œ5 èŠ‚ç‚¹éƒ½å¤„äº Ready çŠ¶æ€ï¼Œè¯´æ˜é›†ç¾¤å®‰è£…æˆåŠŸã€‚



## 4. å°ç»“

æœ¬æ–‡æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ KubeClipper ä½¿ç”¨ç®€å•çš„å‘½ä»¤åˆ›å»º K8S é›†ç¾¤ã€‚

æ•´ä¸ªæµç¨‹å¯ä»¥ç®€å•çš„åˆ†ä¸º 3 ä¸ªæ­¥éª¤ï¼š

* 1ï¼‰å®‰è£… kcctl

```bash
#ä¸æŒ‡å®šVERSIONåˆ™é»˜è®¤å®‰è£…masteråˆ†æ”¯æ„å»ºç‰ˆæœ¬
curl -sfL https://oss.kubeclipper.io/kcctl.sh | KC_REGION=cn VERSION=v1.3.1 bash -
```

* 2ï¼‰ä½¿ç”¨ kcctl éƒ¨ç½² kubeclipper

```bash
kcctl deploy [--user root] (--passwd SSH_PASSWD | --pk-file SSH_PRIVATE_KEY) (--server SERVER_NODES) (--agent AGENT_NODES)
```

* 3ï¼‰ä½¿ç”¨ kcctl æˆ–æ§åˆ¶å°åˆ›å»º K8S é›†ç¾¤

```bash
kcctl create cluster (--name CLUSTER_NAME) (--master NODES) [--worker NODES][ --untaint-master] 
```

æ–‡ä¸­æ‰€æœ‰æ“ä½œå‡é€šè¿‡å‘½ä»¤è¡Œå·¥å…·å®Œæˆï¼Œè‡³äºæ§åˆ¶å°ç›¸å…³åŠŸèƒ½åˆ™ç”±å¤§å®¶è‡ªè¡Œæ¢ç´¢äº†~



> å¦‚æœè§‰å¾—ä½“éªŒè¿˜ä¸é”™çš„è¯ï¼Œè¯·ä¸è¦åå•¬ä½ çš„ star ï¼Œ[KubeClipper](https://github.com/kubeclipper) è¿˜å¤„äºå¿«é€Ÿæˆé•¿é˜¶æ®µï¼Œæ¬¢è¿å¤§å®¶ç§¯æå‚ä¸~