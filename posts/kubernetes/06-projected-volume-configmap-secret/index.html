<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件 -</title><meta name=Description content="通过ConfigMap与Secret管理配置文件"><meta property="og:title" content="Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件"><meta property="og:description" content="通过ConfigMap与Secret管理配置文件"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/"><meta property="og:image" content="https://blog.yudlk.com/img/jinx.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-04-23T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-23T00:00:00+00:00"><meta property="og:site_name" content="qpt的个人博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.yudlk.com/img/jinx.png"><meta name=twitter:title content="Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件"><meta name=twitter:description content="通过ConfigMap与Secret管理配置文件"><meta name=application-name content="面对疾风"><meta name=apple-mobile-web-app-title content="面对疾风"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/><link rel=prev href=https://blog.yudlk.com/posts/grpc/10-benchmark/><link rel=next href=https://blog.yudlk.com/posts/web/%E8%AE%BE%E5%A4%87%E8%BF%BD%E8%B8%AA%E4%B9%8Bcanvas%E6%8C%87%E7%BA%B9/><link rel=stylesheet href=/css/style.min.cf6878db51c51b2d04ae155284a4403dbee8db33e16c066f954c95279c271fcd.css integrity="sha256-z2h421HFGy0ErhVShKRAPb7o2zPhbAZvlUyVJ5wnH80="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.yudlk.com\/posts\/kubernetes\/06-projected-volume-configmap-secret\/"},"image":["https:\/\/blog.yudlk.com\/img\/jinx.png"],"genre":"posts","keywords":"Kubernetes","wordcount":3023,"url":"https:\/\/blog.yudlk.com\/posts\/kubernetes\/06-projected-volume-configmap-secret\/","datePublished":"2021-04-23T00:00:00+00:00","dateModified":"2021-04-23T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"qpt"},"description":"通过ConfigMap与Secret管理配置文件"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>面对疾风</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title=面对疾风>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/ title=关于>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>面对疾风</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title=面对疾风>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title=关于>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/barrypt title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>qpt</a></span>&nbsp;<span class=post-category>included in <a href=/categories/kubernetes/><i class="far fa-folder fa-fw" aria-hidden=true></i>Kubernetes</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-04-23>2021-04-23</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;3023 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;7 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-概述>1. 概述</a></li><li><a href=#2-configmap>2. ConfigMap</a><ul><li><a href=#1-创建>1. 创建</a></li><li><a href=#2-使用>2. 使用</a></li></ul></li><li><a href=#3-secret>3. Secret</a><ul><li><a href=#1-创建-1>1. 创建</a></li><li><a href=#2-使用-1>2. 使用</a></li></ul></li><li><a href=#4-downward-api>4. Downward API</a></li><li><a href=#5-参考>5. 参考</a></li></ul></nav></div></div><div class=content id=content><p>本文主要记录了 Kubernetes 中的几种 Projected Volume，包括 ConfigMap、Secret、Downward API、ServiceAccountToken等。</p><h2 id=1-概述>1. 概述</h2><p>在 Kubernetes 中，有几种特殊的 Volume，它们存在的意义不是为了存放容器里的数据，也不是用来进行容器和宿主机之间的数据交换。</p><p><strong>这些特殊 Volume 的作用，是为容器提供预先定义好的数据</strong>。</p><p>所以，从容器的角度来看，这些 Volume 里的信息就是仿佛是被 Kubernetes“投射”（Project）进入容器当中的。这正是 Projected Volume 的含义。</p><p>到目前为止，Kubernetes 支持的 Projected Volume 一共有四种：</p><ul><li>1）ConfigMap；</li><li>2）Secret；</li><li>3）Downward API；</li><li>4）ServiceAccountToken。</li></ul><p>ConfigMap 顾名思义，是用于保存配置数据的键值对，可以用来保存单个属性，也可以保存配置文件。</p><p>Secret 可以为 Pod 提供密码、Token、私钥等敏感数据；对于一些非敏感数据，比如应用的配置信息，则可以使用 ConfigMap。</p><blockquote><p>就是把数据存放到 Etcd 中。然后，你就可以通过在 Pod 的容器里挂载 Volume 的方式，访问到这些 Secret、ConfigMap 里保存的信息了。</p></blockquote><p>Downward API，它的作用是：让 Pod 里的容器能够直接获取到这个 Pod API 对象本身的信息。</p><blockquote><p>不过，需要注意的是，Downward API 能够获取到的信息，<strong>一定是 Pod 里的容器进程启动之前就能够确定下来的信息</strong>。</p></blockquote><p>其实，Secret、ConfigMap，以及 Downward API 这三种 Projected Volume 定义的信息，大多还可以通过环境变量的方式出现在容器里。但是，通过环境变量获取这些信息的方式，不具备自动更新的能力。<strong>所以，一般情况下，都建议使用 Volume 文件的方式获取这些信息</strong>，Volume 方式可以自动更新，不过可能会有一定延迟。</p><p>ServiceAccountToken 一种特殊的 Secret，是 Kubernetes 系统内置的一种“服务账户”，它是 Kubernetes 进行权限分配的对象。</p><blockquote><p>另外，为了方便使用，Kubernetes 已经为你提供了一个默认“服务账户”（default Service Account）。并且，任何一个运行在 Kubernetes 里的 Pod，都可以直接使用这个默认的 Service Account，而无需显示地声明挂载它（k8s 默认会为每一个Pod 都挂载该Volume）。</p></blockquote><h2 id=2-configmap>2. ConfigMap</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 创建</span>
</span></span><span class=line><span class=cl>$ kubectl create configmap 
</span></span><span class=line><span class=cl><span class=c1># 删除</span>
</span></span><span class=line><span class=cl>$ kubectl delete configmap ConfigMap名称
</span></span><span class=line><span class=cl><span class=c1># 编辑</span>
</span></span><span class=line><span class=cl>$ kubectl edit configmap ConfigMap名称
</span></span><span class=line><span class=cl><span class=c1># 查看-列表</span>
</span></span><span class=line><span class=cl>$ kubectl get configmap
</span></span><span class=line><span class=cl><span class=c1># 查看-详情</span>
</span></span><span class=line><span class=cl>$ kubectl describe configmap ConfigMap名称
</span></span></code></pre></div><h3 id=1-创建>1. 创建</h3><p>可以使用 <code>kubectl create configmap</code> 从以下多种方式创建 ConfigMap。</p><ul><li>1）<strong>yaml 描述文件</strong>：事先写好标准的configmap的yaml文件，然后kubectl create -f 创建</li><li>2）<strong>&ndash;from-file</strong>：通过指定目录或文件创建，将一个或多个配置文件创建为一个ConfigMap</li><li>3）<strong>&ndash;from-literal</strong>：通过直接在命令行中通过 key-value 字符串方式指定configmap参数创建</li><li>4）<strong>&ndash;from-env-file</strong>：从 env 文件读取配置信息并创建为一个ConfigMap</li></ul><p><strong>yaml 描述文件</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl create -f configmap.yaml 
</span></span><span class=line><span class=cl>configmap/test-conf created
</span></span><span class=line><span class=cl>$ kubectl get configmaps
</span></span><span class=line><span class=cl>NAME        DATA   AGE
</span></span><span class=line><span class=cl>cm1   <span class=m>1</span>      8s
</span></span><span class=line><span class=cl>$ kubectl describe configmap test-conf
</span></span><span class=line><span class=cl>Name:         cm1
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>Data</span>
</span></span><span class=line><span class=cl><span class=o>====</span>
</span></span><span class=line><span class=cl>user:
</span></span><span class=line><span class=cl>----
</span></span><span class=line><span class=cl>name: <span class=s2>&#34;17x&#34;</span>
</span></span><span class=line><span class=cl>github: <span class=s2>&#34;https://github.com/barrypt&#34;</span>
</span></span><span class=line><span class=cl>blog: <span class=s2>&#34;https://www.lixueduan.com&#34;</span>
</span></span><span class=line><span class=cl>Events:  &lt;none&gt;
</span></span></code></pre></div><p><code>configmap.yaml</code> 如下:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ConfigMap</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cm1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>user</span><span class=p>:</span><span class=w> </span><span class=p>|+</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>    name: &#34;17x&#34;
</span></span></span><span class=line><span class=cl><span class=sd>    github: &#34;https://github.com/barrypt&#34;
</span></span></span><span class=line><span class=cl><span class=sd>    blog: &#34;https://www.lixueduan.com&#34;</span><span class=w>    
</span></span></span></code></pre></div><p><strong>&ndash;from-file</strong></p><ul><li>1）单文件</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl create configmap cm2 --from-file<span class=o>=</span>conf-17x.yaml 
</span></span><span class=line><span class=cl>configmap/cm1 created
</span></span><span class=line><span class=cl>$ kubectl get configmaps
</span></span><span class=line><span class=cl>NAME   DATA   AGE
</span></span><span class=line><span class=cl>cm2    <span class=m>1</span>      17s
</span></span><span class=line><span class=cl>$ kubectl get configmap cm2 -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>user:name: <span class=s2>&#34;17x&#34;</span>
</span></span><span class=line><span class=cl>github: <span class=s2>&#34;https://github.com/barrypt&#34;</span>
</span></span><span class=line><span class=cl>blog: <span class=s2>&#34;https://www.lixueduan.com&#34;</span><span class=o>]</span>
</span></span></code></pre></div><p>配置文件如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>User</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;17x&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>Github</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://github.com/barrypt&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>Blog</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;https://www.lixueduan.com&#34;</span><span class=w>
</span></span></span></code></pre></div><ul><li>2）目录</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 从 conf 目录下多个文件读取配置信息</span>
</span></span><span class=line><span class=cl>$ kubectl create configmap cm3 --from-file<span class=o>=</span>conf
</span></span><span class=line><span class=cl>configmap/cm3 created
</span></span><span class=line><span class=cl>$ kubectl get configmaps
</span></span><span class=line><span class=cl>NAME        DATA   AGE
</span></span><span class=line><span class=cl>cm3         <span class=m>2</span>      8s
</span></span><span class=line><span class=cl>$ kubectl get configmap cm3 -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>conf1.yaml:User: <span class=s2>&#34;17x&#34;</span>
</span></span><span class=line><span class=cl>Github: <span class=s2>&#34;https://github.com/barrypt&#34;</span>
</span></span><span class=line><span class=cl>Blog: <span class=s2>&#34;https://www.lixueduan.com&#34;</span>
</span></span><span class=line><span class=cl> conf2.yaml:User: <span class=s2>&#34;17x&#34;</span>
</span></span><span class=line><span class=cl>Github: <span class=s2>&#34;https://github.com/barrypt&#34;</span>
</span></span><span class=line><span class=cl>Blog: <span class=s2>&#34;https://www.refersmoon.com&#34;</span>
</span></span></code></pre></div><p><strong>&ndash;from-literal</strong></p><blockquote><p>每个 &ndash;from-literal 对应一个信息条目。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl create configmap cm4 --from-literal<span class=o>=</span><span class=nv>name</span><span class=o>=</span><span class=s2>&#34;17x&#34;</span> --from-literal<span class=o>=</span><span class=nv>blog</span><span class=o>=</span><span class=s2>&#34;https://www.lixueduan.com&#34;</span>
</span></span><span class=line><span class=cl>configmap <span class=s2>&#34;cm4&#34;</span> created
</span></span><span class=line><span class=cl>$ kubectl get configmap cm4 -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>blog:https://www.lixueduan.com name:17x<span class=o>][</span>root@iZ2ze9ebgot9h2acvk4uabZ configmap<span class=o>]</span>
</span></span></code></pre></div><p><strong>&ndash;from-env-file</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl create configmap cm5 --from-env-file<span class=o>=</span>conf.env 
</span></span><span class=line><span class=cl>configmap/cm5 created
</span></span><span class=line><span class=cl>$ kubectl get configmap cm5 -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>blog:https://www.lixueduan.com github:https://github.com/barrypt name:17x<span class=o>]</span>
</span></span></code></pre></div><p><code>conf.env</code>文件如下</p><blockquote><p>语法为 key=value</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-env data-lang=env><span class=line><span class=cl><span class=nv>name</span><span class=o>=</span>17x
</span></span><span class=line><span class=cl><span class=nv>github</span><span class=o>=</span>https://github.com/barrypt
</span></span><span class=line><span class=cl><span class=nv>blog</span><span class=o>=</span>https://www.lixueduan.com
</span></span></code></pre></div><h3 id=2-使用>2. 使用</h3><p>Pod 可以通过三种方式来使用 ConfigMap，分别为：</p><ul><li>将 ConfigMap 中的数据设置为环境变量</li><li>使用 Volume 将 ConfigMap 作为文件或目录挂载<ul><li><strong>注意：ConfigMap 中的每一个Key都会单独挂载为一个文件</strong></li></ul></li></ul><p><strong>注意！！</strong></p><ul><li>ConfigMap 必须在 Pod 使用它之前创建</li><li>使用 envFrom 时，将会自动忽略无效的键</li><li>一个Pod 只能使用同一个命名空间的 ConfigMap</li></ul><p><strong>用作环境变量</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl create configmap cm1 --from-literal<span class=o>=</span><span class=nv>first</span><span class=o>=</span><span class=s2>&#34;hello world&#34;</span> --from-literal<span class=o>=</span><span class=nv>second</span><span class=o>=</span><span class=s2>&#34;hello configmap&#34;</span>
</span></span><span class=line><span class=cl>$ kubectl create configmap env-cm --from-literal<span class=o>=</span><span class=nv>log_level</span><span class=o>=</span>INFO
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;env&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CUSTOM_FIRST</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cm1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>first</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CUSTOM_SECOND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>configMapKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cm1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>second</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>envFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>configMapRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>env-cm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span></code></pre></div><p>通过 <code>env</code>单个指定或者通过<code>envFrom</code>直接加载整个 configmap</p><p>根据以上 yaml 文件创建 pod 并查看日志</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl apply -f cm.yaml
</span></span><span class=line><span class=cl><span class=c1># 查看日志 会打印出一堆环境变量 其中就有我们指定的 configmap</span>
</span></span><span class=line><span class=cl>$ kubectl logs test-pod
</span></span><span class=line><span class=cl><span class=nv>log_level</span><span class=o>=</span>INFO
</span></span><span class=line><span class=cl><span class=nv>CUSTOM_FIRST</span><span class=o>=</span>hello world
</span></span><span class=line><span class=cl><span class=nv>CUSTOM_SECOND</span><span class=o>=</span>hello configmap
</span></span></code></pre></div><p><strong>使用 Volume 将 ConfigMap 作为文件或目录挂载</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/foo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>/bin/sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- -<span class=l>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sleep 10; touch /tmp/healthy; sleep 30000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>foo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>configMap</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cm1</span><span class=w>
</span></span></span></code></pre></div><p>进入 pod 查看，会在前面指定的 /etc/foo 目录下创建 configmap中的文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl apply -f cm2.pod.yaml 
</span></span><span class=line><span class=cl><span class=c1># 进入 pod 查看，会在前面指定的 /etc/foo 目录下创建 configmap中的文件</span>
</span></span><span class=line><span class=cl>$ kubectl <span class=nb>exec</span> -it test-pod sh
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> /etc/foo/
</span></span><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>first   second
</span></span><span class=line><span class=cl>$ cat first 
</span></span><span class=line><span class=cl>hello world
</span></span></code></pre></div><h2 id=3-secret>3. Secret</h2><p>Secret 和 Configmap 类似，不过 Secret 是加密后的，一般用于存储敏感数据，如 比如密码，token，密钥等。</p><p>Secret有三种类型：</p><ul><li><p>1）<strong>Opaque</strong>：base64 编码格式的 Secret，用来存储密码、密钥等；但数据也可以通过base64 –decode解码得到原始数据，所以加密性很弱。</p></li><li><p>2）<strong>Service Account</strong>：用来访问Kubernetes API，由Kubernetes自动创建，并且会自动挂载到Pod的 /run/secrets/kubernetes.io/serviceaccount 目录中。</p></li><li><p>3）<strong>kubernetes.io/dockerconfigjson</strong> ： 用来存储私有docker registry的认证信息。</p></li></ul><h3 id=1-创建-1>1. 创建</h3><p>Secret 同样有多种创建方式</p><ul><li>1）<strong>yaml 描述文件</strong>：事先写好标准的secret的yaml文件，然后kubectl create -f 创建</li><li>2）<strong>&ndash;from-file</strong>：通过指定目录或文件创建，将一个或多个配置文件创建为一个Secret</li><li>3）<strong>&ndash;from-literal</strong>：通过直接在命令行中通过 key-value 字符串方式指定configmap参数创建</li></ul><p><strong>yaml 描述文件</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl apply -f secret.yaml 
</span></span><span class=line><span class=cl>secret/mysecret created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># describe 或者 get 命令不会直接显示 secret 中的内容</span>
</span></span><span class=line><span class=cl>$ kubectl get secret mysecret -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>hello:d29ybGQ<span class=o>=</span>
</span></span></code></pre></div><p><code>secret.yaml </code>内容如下：</p><blockquote><p><strong>注意</strong>：通过yaml创建Opaque类型的Secret值需要base64编码</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ <span class=nb>echo</span> -n <span class=s1>&#39;world&#39;</span><span class=p>|</span>base64
</span></span><span class=line><span class=cl><span class=nv>d29ybGQ</span><span class=o>=</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c>#secret.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysecret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hello</span><span class=p>:</span><span class=w> </span><span class=l>d29ybGQ=</span><span class=w>
</span></span></span></code></pre></div><p><strong>&ndash;from-file</strong></p><p>直接从文件创建，默认 key 为文件名</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ cat hello.txt 
</span></span><span class=line><span class=cl>world
</span></span><span class=line><span class=cl><span class=c1># generic 表示创建普通 secret</span>
</span></span><span class=line><span class=cl>$ kubectl create secret generic s1 --from-file<span class=o>=</span>hello.txt 
</span></span><span class=line><span class=cl>secret/s1 created
</span></span><span class=line><span class=cl>$ kubectl get secrets
</span></span><span class=line><span class=cl>NAME                                              TYPE                                  DATA   AGE
</span></span><span class=line><span class=cl>s1                                                Opaque                                <span class=m>1</span>     20s
</span></span><span class=line><span class=cl><span class=c1># describe 或者 get 命令不会直接显示 secret 中的内容</span>
</span></span><span class=line><span class=cl>$ kubectl get secret s1 -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>hello.txt:d29ybGQK<span class=o>]</span>
</span></span></code></pre></div><p><strong>&ndash;from-literal</strong></p><p>字符串方式可以手动指定 key、value</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl create secret generic s2 --from-literal<span class=o>=</span><span class=nv>hello</span><span class=o>=</span>world
</span></span><span class=line><span class=cl>secret/s2 created
</span></span><span class=line><span class=cl>$ kubectl get secret s1 -o go-template<span class=o>=</span><span class=s1>&#39;{{.data}}&#39;</span>
</span></span><span class=line><span class=cl>map<span class=o>[</span>hello:d29ybGQ<span class=o>=]</span>
</span></span></code></pre></div><h3 id=2-使用-1>2. 使用</h3><p>同样有两种方式：</p><ul><li>将 Secret 中的数据设置为环境变量</li><li>使用 Volume 将 Secret 作为文件或目录挂载</li></ul><p><strong>用作环境变量</strong></p><blockquote><p>和 configmap 类似，把 configMapKeyRef 替换成 secretKeyRef 即可,同时 secret 是单个的，所以也去掉了批量获取的 envFrom 字段。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># secret-env.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-secret-env-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;/bin/sh&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;env&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>CUSTOM_HELLO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>s2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>hello</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span></code></pre></div><p>运行pod并查看打印出来的环境变量</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl apply -f secret-env.yaml 
</span></span><span class=line><span class=cl>pod/test-secret-env-pod created
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl logs test-secret-env-pod
</span></span><span class=line><span class=cl><span class=nv>CUSTOM_HELLO</span><span class=o>=</span>world
</span></span></code></pre></div><p><strong>Volume 挂载方式</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># secret.pod.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-secret-pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>sleep</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=s2>&#34;3600&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/etc/foo&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>config</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>projected</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mysecret</span><span class=w>
</span></span></span></code></pre></div><p>创建Pod后进入容器查看，可以看到在指定目录<code>/etc/foo</code>中存在我们指定的secret中的内容<code>hello</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ kubectl <span class=nb>exec</span> -it test-secret-pod sh
</span></span><span class=line><span class=cl>/ <span class=c1># ls</span>
</span></span><span class=line><span class=cl>bin   dev   etc   home  proc  root  sys   tmp   usr   var
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> etc/foo/
</span></span><span class=line><span class=cl>$ ls
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl>$ cat hello 
</span></span><span class=line><span class=cl>world
</span></span></code></pre></div><h2 id=4-downward-api>4. Downward API</h2><p>它的作用是：让 Pod 里的容器能够直接获取到这个 Pod API 对象本身的信息。</p><p>不过，需要注意的是，Downward API 能够获取到的信息，<strong>一定是 Pod 里的容器进程启动之前就能够确定下来的信息</strong>。</p><p>举个例子</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-downwardapi-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zone</span><span class=p>:</span><span class=w> </span><span class=l>us-est-coast</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class=l>test-cluster1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rack</span><span class=p>:</span><span class=w> </span><span class=l>rack-22</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>client-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>k8s.gcr.io/busybox</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-c&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>args</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>while true; do</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>if [[ -e /etc/podinfo/labels ]]; then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=l>echo -en &#39;\n\n&#39;; cat /etc/podinfo/labels; fi;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=l>sleep 5;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=l>done;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>podinfo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>projected</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>downwardAPI</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>items</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span>- <span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;labels&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=nt>fieldRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class=l>metadata.labels</span><span class=w>
</span></span></span></code></pre></div><p>在这个 Pod 的 YAML 文件中，我定义了一个简单的容器，声明了一个 projected 类型的 Volume。只不过这次 Volume 的数据来源，变成了 Downward API。而这个 Downward API Volume，则声明了要暴露 Pod 的 <strong>metadata.labels</strong> 信息给容器。</p><h2 id=5-参考>5. 参考</h2><p><code>https://kubernetes.io/docs/concepts/configuration/configmap/</code></p><p><code>https://kubernetes.io/docs/concepts/configuration/secret/</code></p><p><code>深入剖析Kubernetes</code></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-04-23</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/ data-title=Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件 data-hashtags=Kubernetes><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/ data-hashtag=Kubernetes><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/ data-title=Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/ data-title=Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://blog.yudlk.com/posts/kubernetes/06-projected-volume-configmap-secret/ data-title=Kubernetes教程(六)---通过ConfigMap与Secret管理配置文件><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/kubernetes/>Kubernetes</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/grpc/10-benchmark/ class=prev rel=prev title=gRPC(Go)教程(十)---gRPC压测工具ghz><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>gRPC(Go)教程(十)---gRPC压测工具ghz</a>
<a href=/posts/web/%E8%AE%BE%E5%A4%87%E8%BF%BD%E8%B8%AA%E4%B9%8Bcanvas%E6%8C%87%E7%BA%B9/ class=next rel=next title=设备追踪之Canvas指纹>设备追踪之Canvas指纹<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/barrypt target=_blank>qpt</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a rel="license external nofollow noopener noreffer" href=https://beian.miit.gov.cn/ target=_blank>渝ICP备20005680号-1</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.480e58b2c2a8605d406f34667e92ff8f1ae50cfee5b653bead570f004839a983.js integrity="sha256-SA5YssKoYF1AbzRmfpL/jxrlDP7ltlO+rVcPAEg5qYM="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-FL23FNP7CM',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-FL23FNP7CM" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4b7c98449a6edf8492a8f3404e6d06a0",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7693630257897132" crossorigin=anonymous></script></body></html>