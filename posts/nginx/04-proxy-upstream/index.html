<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Nginx教程(四)---反向代理与负载均衡 -</title><meta name=Description content="Nginx反向代理和负载均衡配置与使用"><meta property="og:title" content="Nginx教程(四)---反向代理与负载均衡"><meta property="og:description" content="Nginx反向代理和负载均衡配置与使用"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.yudlk.com/posts/nginx/04-proxy-upstream/"><meta property="og:image" content="https://blog.yudlk.com/img/jinx.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-17T22:00:00+00:00"><meta property="article:modified_time" content="2019-02-17T22:00:00+00:00"><meta property="og:site_name" content="qpt的个人博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.yudlk.com/img/jinx.png"><meta name=twitter:title content="Nginx教程(四)---反向代理与负载均衡"><meta name=twitter:description content="Nginx反向代理和负载均衡配置与使用"><meta name=application-name content="面对疾风"><meta name=apple-mobile-web-app-title content="面对疾风"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.yudlk.com/posts/nginx/04-proxy-upstream/><link rel=prev href=https://blog.yudlk.com/posts/nginx/03-log/><link rel=next href=https://blog.yudlk.com/posts/java/07-jvm-runtime-area/><link rel=stylesheet href=/css/style.min.cf6878db51c51b2d04ae155284a4403dbee8db33e16c066f954c95279c271fcd.css integrity="sha256-z2h421HFGy0ErhVShKRAPb7o2zPhbAZvlUyVJ5wnH80="><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload="this.onload=null,this.rel='stylesheet'"><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Nginx教程(四)---反向代理与负载均衡","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.yudlk.com\/posts\/nginx\/04-proxy-upstream\/"},"image":["https:\/\/blog.yudlk.com\/img\/jinx.png"],"genre":"posts","keywords":"Nginx","wordcount":1976,"url":"https:\/\/blog.yudlk.com\/posts\/nginx\/04-proxy-upstream\/","datePublished":"2019-02-17T22:00:00+00:00","dateModified":"2019-02-17T22:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"qpt"},"description":"Nginx反向代理和负载均衡配置与使用"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title>面对疾风</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title=面对疾风>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/ title=关于>关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title>面对疾风</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title=面对疾风>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title=关于>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Nginx教程(四)---反向代理与负载均衡</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/barrypt title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>qpt</a></span>&nbsp;<span class=post-category>included in <a href=/categories/nginx/><i class="far fa-folder fa-fw" aria-hidden=true></i>Nginx</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2019-02-17>2019-02-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1976 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-反向代理proxy>1. 反向代理(proxy)</a><ul><li><a href=#11-简介>1.1 简介</a></li><li><a href=#12-配置>1.2 配置</a></li><li><a href=#13-测试>1.3 测试</a></li><li><a href=#14-问题>1.4 问题</a></li></ul></li><li><a href=#2-负载均衡upstream>2. 负载均衡(upstream)</a><ul><li><a href=#21-简介>2.1 简介</a></li><li><a href=#22-配置>2.2 配置</a></li><li><a href=#23-测试>2.3 测试</a></li></ul></li><li><a href=#3-参考>3. 参考</a></li></ul></nav></div></div><div class=content id=content><p>本章主要通过实例简单介绍了Nginx反向代理和负载均衡功能。</p><h2 id=1-反向代理proxy>1. 反向代理(proxy)</h2><h3 id=11-简介>1.1 简介</h3><p><strong>如果您的内容服务器具有必须保持安全的敏感信息，如信用卡号数据库，可在防火墙外部设置一个<code>代理服务器</code>作为<code>内容服务器的替身</code></strong>。</p><p>当外部客户机尝试访问内容服务器时，会将其送到代理服务器。实际内容位于内容服务器上，在防火墙内部受到安全保护。代理服务器位于防火墙外部，在客户机看来就像是内容服务器。</p><p>这样，代理服务器就在安全数据库和可能的恶意攻击之间提供了又一道屏障。与有权访问整个数据库的情况相对比，就算是侥幸攻击成功，作恶者充其量也仅限于访问单个事务中所涉及的信息。未经授权的用户无法访问到真正的内容服务器，因为防火墙通路只允许代理服务器有权进行访问。</p><p><strong>就是客户端先访问Nginx服务器，Nginx收到请求后再去请求内容服务器,这样中间多了一个Nginx服务器中转，会更加安全</strong>。</p><h3 id=12-配置>1.2 配置</h3><h4 id=1-修改配置文件>1. 修改配置文件</h4><p>首先需要修改<code>Nginx服务器</code>配置文件``nginx.conf`。</p><p>配置文件大概是这样的，在<code>server</code>中添加一个<code>location</code>用于中转。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>http{</span>
</span></span><span class=line><span class=cl>    <span class=s>keepalive_timeout</span>  <span class=mi>65</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>server{</span>
</span></span><span class=line><span class=cl>        <span class=s>listen</span> <span class=mi>80</span><span class=p>;</span> <span class=k>//端口号</span>
</span></span><span class=line><span class=cl>        <span class=s>server_name</span> <span class=s>localhost</span><span class=p>;</span> <span class=k>//域名</span>
</span></span><span class=line><span class=cl>        <span class=s>location</span> <span class=s>\</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kn>root</span> <span class=s>html</span><span class=p>;</span> <span class=kn>//网站根目录</span>
</span></span><span class=line><span class=cl>            <span class=s>index</span> <span class=s>index.html</span><span class=p>;</span> <span class=kn>//网站首页</span>
</span></span><span class=line><span class=cl>        <span class=err>}</span>  
</span></span><span class=line><span class=cl>        <span class=s>access_log</span>  <span class=s>logs/host.access.log</span>  <span class=s>main</span><span class=p>;</span> <span class=kn>//访问日志</span>
</span></span><span class=line><span class=cl>        <span class=s>error</span> <span class=s>page</span> <span class=mi>500</span> <span class=s>error.html</span><span class=p>;</span> <span class=kn>//错误页面</span>
</span></span><span class=line><span class=cl>        <span class=c1>#这里就是代理 通过正则表达式来匹配
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>#后缀以.jsp结尾的请求都会跳转到 http://192.168.5.154:8080;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=s>location</span> <span class=p>~</span> <span class=sr>\.jsp$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kn>proxy_pass</span>   <span class=s>http://192.168.5.154:8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>}</span>
</span></span></code></pre></div><h4 id=2-开启内容服务器>2. 开启内容服务器</h4><p>然后在<code>192.168.5.154</code>的<code>8080</code>端口开启了一个``tomcat<code>,当做是真正的内容服务器，在tomcat默认的</code>index.jsp`中添加了一句显示IP地址的。</p><pre tabindex=0><code class=language-jsp data-lang=jsp>&lt;!--测试Nginx反向代理新增--&gt;
remote ip:&lt;%=request.getRemoteAddr()%&gt;
</code></pre><h3 id=13-测试>1.3 测试</h3><p>然后开始访问：</p><p>首先直接访问内容服务器(Tomcat)：<code>192.168.5.154:8080</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>remote</span> <span class=n>ip</span><span class=o>:</span><span class=n>192</span><span class=o>.</span><span class=na>168</span><span class=o>.</span><span class=na>5</span><span class=o>.</span><span class=na>199</span> 
</span></span></code></pre></div><p>然后访问Nginx通过代理来访问内容服务器：<code>192.168.5.154/index.jsp</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>remote</span> <span class=n>ip</span><span class=o>:</span><span class=n>192</span><span class=o>.</span><span class=na>168</span><span class=o>.</span><span class=na>5</span><span class=o>.</span><span class=na>154</span>
</span></span></code></pre></div><p>显示远程 IP是192.168.5.154，这个刚好就是Nginx服务器的IP；</p><p>反向代理成功。</p><h3 id=14-问题>1.4 问题</h3><p>前面设置后反向代理已经成功了,但是这样设置后，每次访问内容服务器都显示的是Nginx服务器的IP,内容服务器无法获取用户的真实IP，所以还需要进行一点修改。</p><h4 id=1-修改>1. 修改</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>http{</span>
</span></span><span class=line><span class=cl>    <span class=s>keepalive_timeout</span>  <span class=mi>65</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>server{</span>
</span></span><span class=line><span class=cl>        <span class=s>listen</span> <span class=mi>80</span><span class=p>;</span> <span class=k>//端口号</span>
</span></span><span class=line><span class=cl>        <span class=s>server_name</span> <span class=s>localhost</span><span class=p>;</span> <span class=k>//域名</span>
</span></span><span class=line><span class=cl>        <span class=s>location</span> <span class=s>\</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kn>root</span> <span class=s>html</span><span class=p>;</span> <span class=kn>//网站根目录</span>
</span></span><span class=line><span class=cl>            <span class=s>index</span> <span class=s>index.html</span><span class=p>;</span> <span class=kn>//网站首页</span>
</span></span><span class=line><span class=cl>        <span class=err>}</span>  
</span></span><span class=line><span class=cl>        <span class=s>access_log</span>  <span class=s>logs/host.access.log</span>  <span class=s>main</span><span class=p>;</span> <span class=kn>//访问日志</span>
</span></span><span class=line><span class=cl>        <span class=s>error</span> <span class=s>page</span> <span class=mi>500</span> <span class=s>error.html</span><span class=p>;</span> <span class=kn>//错误页面</span>
</span></span><span class=line><span class=cl>        <span class=c1>#这里就是代理 通过正则表达式来匹配
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>#后缀以.jsp结尾的请求都会跳转到 http://192.168.5.154:8080;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=s>location</span> <span class=p>~</span> <span class=sr>\.jsp$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>#在请求头中添加上真实的IP 
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>#具体格式为 proxy_set_header 属性名 数据
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=kn>proxy_set_header</span> <span class=s>X-real-ip</span> <span class=nv>$remote_addr</span>
</span></span><span class=line><span class=cl>            <span class=s>proxy_pass</span>   <span class=s>http://192.168.5.154:8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>}</span>
</span></span></code></pre></div><p><code>proxy_set_header X-real-ip $remote_addr</code> :Nginx服务器是知道客户端真实IP的，所以为了让内容服务器知道真实IP，只需要将真实IP添加到请求头中就可以了。</p><p>其中<code>X-real-ip</code> 是自定义的，内容服务器取数据时也使用这个<code>X-real-ip</code></p><p><code>$remote_addr</code> 则是获取远程客户端IP。</p><h4 id=2-测试>2. 测试：</h4><p>修改jsp，添加了一句代码。</p><pre tabindex=0><code class=language-jsp data-lang=jsp>                &lt;!--测试Nginx反向代理新增--&gt;
 			   &lt;!--获取请求头中的真实IP--&gt;
                Real remote ip:&lt;%=request.getHeader(&#34;X-real-ip&#34;)%&gt; &lt;br /&gt;
                remote ip/Nginx ip:&lt;%=request.getRemoteAddr()%&gt;
</code></pre><p>然后开始访问：</p><p>首先直接访问内容服务器(Tomcat)：<code>192.168.5.154:8080</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Real</span> <span class=n>remote</span> <span class=n>ip</span><span class=o>:</span><span class=kc>null</span> 
</span></span><span class=line><span class=cl><span class=n>remote</span> <span class=n>ip</span><span class=o>/</span><span class=n>Nginx</span> <span class=n>ip</span><span class=o>:</span><span class=n>192</span><span class=o>.</span><span class=na>168</span><span class=o>.</span><span class=na>5</span><span class=o>.</span><span class=na>199</span> 
</span></span></code></pre></div><p>然后访问Nginx通过代理来访问内容服务器：<code>192.168.5.154/index.jsp</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Real</span> <span class=n>remote</span> <span class=n>ip</span><span class=o>:</span><span class=n>192</span><span class=o>.</span><span class=na>168</span><span class=o>.</span><span class=na>5</span><span class=o>.</span><span class=na>199</span> 
</span></span><span class=line><span class=cl><span class=n>remote</span> <span class=n>ip</span><span class=o>/</span><span class=n>Nginx</span> <span class=n>ip</span><span class=o>:</span><span class=n>192</span><span class=o>.</span><span class=na>168</span><span class=o>.</span><span class=na>5</span><span class=o>.</span><span class=na>154</span>
</span></span></code></pre></div><p>成功获取到真实IP，问题解决。</p><h2 id=2-负载均衡upstream>2. 负载均衡(upstream)</h2><h3 id=21-简介>2.1 简介</h3><p><strong>可以在一个组织内使用多个代理服务器来平衡各 Web 服务器间的网络负载</strong>。</p><p>对于客户机发往真正服务器的请求，代理服务器起着中间调停者的作用。客户机每次都使用同一个 URL，但请求所采取的路由每次都可能经过不同的代理服务器。</p><p><strong>同样是客户端先访问Nginx服务器，然后Nginx服务器再根据负载均衡算法将请求分发到不同的内容服务器上</strong>。</p><h3 id=22-配置>2.2 配置</h3><p>同意需要修改<code>Nginx服务器</code>配置文件``nginx.conf`。</p><p>配置文件大概是这样的，在<code>server</code>中添加一个<code>location</code>用于中转。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>http{</span>
</span></span><span class=line><span class=cl>    <span class=s>keepalive_timeout</span>  <span class=mi>65</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#upstream 负载均衡 与server同级
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#tomcat_server 负载均衡名字 自定义的 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#要用在下面location反向代理处 
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>#poxy_pass   http://tomcat_server;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>upstream</span> <span class=s>tomcat_server</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>#weight权重 max_fails 最大失败次数 超过后就认为该节点down掉了 fail_timeout 超时时间
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>#192.168.5.154:8080 IP地址或者域名都可以
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>server</span> <span class=n>192.168.5.154</span><span class=p>:</span><span class=mi>8080</span> <span class=s>weight=1</span> <span class=s>max_fails=2</span> <span class=s>fail_timeout=30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>server</span> <span class=n>192.168.5.155</span><span class=p>:</span><span class=mi>8080</span> <span class=s>weight=1</span> <span class=s>max_fails=2</span> <span class=s>fail_timeout=30s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>server{</span>
</span></span><span class=line><span class=cl>        <span class=s>listen</span> <span class=mi>80</span><span class=p>;</span> <span class=k>//端口号</span>
</span></span><span class=line><span class=cl>        <span class=s>server_name</span> <span class=s>localhost</span><span class=p>;</span> <span class=k>//域名</span>
</span></span><span class=line><span class=cl>        <span class=s>location</span> <span class=s>\</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kn>root</span> <span class=s>html</span><span class=p>;</span> <span class=kn>//网站根目录</span>
</span></span><span class=line><span class=cl>            <span class=s>index</span> <span class=s>index.html</span><span class=p>;</span> <span class=kn>//网站首页</span>
</span></span><span class=line><span class=cl>        <span class=err>}</span>  
</span></span><span class=line><span class=cl>        <span class=s>access_log</span>  <span class=s>logs/host.access.log</span>  <span class=s>main</span><span class=p>;</span> <span class=kn>//访问日志</span>
</span></span><span class=line><span class=cl>        <span class=s>error</span> <span class=s>page</span> <span class=mi>500</span> <span class=s>error.html</span><span class=p>;</span> <span class=kn>//错误页面</span>
</span></span><span class=line><span class=cl>        <span class=c1>#proxy_pass 反向代理 通过正则表达式来匹配
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>#后缀以.jsp结尾的请求都会跳转到 http://192.168.5.154:8080;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>#proxy_set_header 将真实IP添加到请求头中 传递到内容服务器
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=s>location</span> <span class=p>~</span> <span class=sr>\.jsp$</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=kn>proxy_set_header</span> <span class=s>X-real-ip</span> <span class=nv>$remote_addr</span>
</span></span><span class=line><span class=cl>            <span class=c1>#proxy_pass   http://192.168.5.154:8080;
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>#反向代理这里不光可以写IP 还可以写上面配置的负载均衡
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=s>proxy_pass</span>   <span class=s>http://tomcat_server</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>}</span>
</span></span></code></pre></div><h3 id=23-测试>2.3 测试</h3><p>开启两个tomcat，一个是<code>192.168.5.154</code>,一个是``192.168.5.155`.</p><p>然后浏览器访问nginx服务器：<code>192.168.5.154/index.jsp</code>；</p><p>会随机跳转到两个tomcat服务器中的一个就说明负载均衡配置成功了。</p><h2 id=3-参考>3. 参考</h2><p><code>http://www.runoob.com/linux/nginx-install-setup.html</code></p><p><code>https://www.cnblogs.com/javahr/p/8318728.html</code></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2019-02-17</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://blog.yudlk.com/posts/nginx/04-proxy-upstream/ data-title=Nginx教程(四)---反向代理与负载均衡 data-hashtags=Nginx><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://blog.yudlk.com/posts/nginx/04-proxy-upstream/ data-hashtag=Nginx><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://blog.yudlk.com/posts/nginx/04-proxy-upstream/ data-title=Nginx教程(四)---反向代理与负载均衡><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://blog.yudlk.com/posts/nginx/04-proxy-upstream/ data-title=Nginx教程(四)---反向代理与负载均衡><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://blog.yudlk.com/posts/nginx/04-proxy-upstream/ data-title=Nginx教程(四)---反向代理与负载均衡><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/nginx/>Nginx</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/nginx/03-log/ class=prev rel=prev title=Nginx教程(三)---日志文件切割><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Nginx教程(三)---日志文件切割</a>
<a href=/posts/java/07-jvm-runtime-area/ class=next rel=next title=Java运行时数据区>Java运行时数据区<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.100.2">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/barrypt target=_blank>qpt</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp><a rel="license external nofollow noopener noreffer" href=https://beian.miit.gov.cn/ target=_blank>渝ICP备20005680号-1</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.480e58b2c2a8605d406f34667e92ff8f1ae50cfee5b653bead570f004839a983.js integrity="sha256-SA5YssKoYF1AbzRmfpL/jxrlDP7ltlO+rVcPAEg5qYM="></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-FL23FNP7CM',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-FL23FNP7CM" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4b7c98449a6edf8492a8f3404e6d06a0",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7693630257897132" crossorigin=anonymous></script></body></html>